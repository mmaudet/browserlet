---
phase: 036-recording-enrichment
plan: 01
subsystem: recording
tags: [aria-landmarks, hints, vue-filtering, angular-filtering, dom-context, semantic-hints]

# Dependency graph
requires:
  - phase: 028-structural-context
    provides: "DOMContextExtractor with landmark extraction, fieldset_context/associated_label/section_context hint types"
provides:
  - "landmark_context hint type (14th type) surfacing ARIA landmark regions during recording"
  - "Expanded framework artifact filtering (Vue data-v-*, Angular _ngcontent-*, ng-reflect-*)"
  - "Explicit Vue 3 / React 18 SSR hydration ID filtering (:r0:, :rN:)"
  - "role='search' landmark detection in DOMContextExtractor"
  - "Updated LLM prompt with landmark_context documentation"
affects: [036-02, playback, bsl-generation, prompt-builder]

# Tech tracking
tech-stack:
  added: []
  patterns: ["Surfacing existing DOMContext fields as new hint types without new DOM traversal"]

key-files:
  created: []
  modified:
    - packages/core/src/types/hints.ts
    - packages/core/src/types/weights.ts
    - entrypoints/content/recording/hintGenerator.ts
    - entrypoints/content/playback/domContextExtractor.ts
    - entrypoints/background/llm/promptBuilder.ts
    - tests/content/recording/hintGenerator.test.ts

key-decisions:
  - "landmark_context weight set to 0.65 (between section_context 0.6 and fieldset_context 0.7) -- landmarks provide coarse page-structure context"
  - "Added role='search' to domContextExtractor LANDMARK_ROLES and CSS selector to enable search landmark detection"

patterns-established:
  - "Framework artifact filtering in isSemanticDataAttribute: reject known framework prefixes before checking semantic prefixes"

requirements-completed: [REC-01, REC-02]

# Metrics
duration: 5min
completed: 2026-02-20
---

# Phase 036 Plan 01: Landmark Context Hint + Framework Filtering Summary

**14th hint type (landmark_context) surfacing ARIA landmark regions, plus Vue/Angular framework artifact filtering in ID and data attribute collection**

## Performance

- **Duration:** 5 min
- **Started:** 2026-02-20T06:30:20Z
- **Completed:** 2026-02-20T06:36:02Z
- **Tasks:** 2
- **Files modified:** 6

## Accomplishments
- Added `landmark_context` as 14th hint type with weight 0.65, surfacing ARIA landmark regions (navigation, main, search, form, banner, contentinfo) during recording
- Expanded `looksAutoGenerated()` to filter Vue 3 colon-wrapper IDs (`:r0:`, `:rN:`) and Angular `ng-*` prefix IDs
- Expanded `isSemanticDataAttribute()` to reject Vue scoped attributes (`data-v-*`) and Angular internal attributes (`_ngcontent-*`, `_nghost-*`, `ng-reflect-*`)
- Updated `promptBuilder.ts` with landmark_context as 12th hint in reliability ordering and full structural context documentation
- Added 10 new tests (4 landmark_context, 3 data attribute filtering, 3 ID filtering) -- all 454 tests pass

## Task Commits

Each task was committed atomically:

1. **Task 1: Add landmark_context hint type with filtering improvements** - `1789005` (feat)
2. **Task 2: Update tests and promptBuilder for landmark_context** - `7541caa` (feat)

## Files Created/Modified
- `packages/core/src/types/hints.ts` - Added `landmark_context` to HintType union (14 types total)
- `packages/core/src/types/weights.ts` - Added `landmark_context: 0.65` weight entry
- `entrypoints/content/recording/hintGenerator.ts` - Hint 14 generation, expanded ID filtering, expanded data attribute filtering
- `entrypoints/content/playback/domContextExtractor.ts` - Added `role="search"` to landmark detection
- `entrypoints/background/llm/promptBuilder.ts` - Added landmark_context to hint type list, structural context docs, and compact prompt
- `tests/content/recording/hintGenerator.test.ts` - 10 new tests for landmark_context, Vue/Angular filtering

## Decisions Made
- landmark_context weight set to 0.65 (between section_context 0.6 and fieldset_context 0.7) -- landmarks provide coarse page-structure context, more stable than section headings but less precise than fieldsets
- Added `role="search"` to domContextExtractor's LANDMARK_ROLES set and CSS selector -- the plan's tests expected search landmark detection but the extractor did not include it

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Added role="search" to domContextExtractor landmark detection**
- **Found during:** Task 1 (landmark_context implementation)
- **Issue:** Plan tests expected `[role="search"]` to produce a `landmark_context` of `'search'`, but domContextExtractor's `LANDMARK_ROLES` set and `extractLandmark` CSS selector did not include `search`
- **Fix:** Added `'search'` to `LANDMARK_ROLES` set and `[role="search"]` to the `extractLandmark` CSS selector in `domContextExtractor.ts`
- **Files modified:** `entrypoints/content/playback/domContextExtractor.ts`
- **Verification:** Test `should capture landmark_context for element inside [role="search"]` passes
- **Committed in:** `1789005` (Task 1 commit)

---

**Total deviations:** 1 auto-fixed (1 blocking)
**Impact on plan:** Single auto-fix was necessary for search landmark support. No scope creep.

## Issues Encountered
- TypeScript initially reported `landmark_context` not assignable to `HintType` due to stale compiled `.d.ts` files in `packages/core/dist/`. Resolved by running `npx tsc --build --force` to regenerate project references. Pre-existing TS errors in unrelated files (firefoxPolyfill.ts, hints/dom.ts) are not from this plan.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- 14 hint types now available for recording and playback
- promptBuilder teaches LLM about landmark_context for BSL generation
- Ready for 036-02 (further recording enrichment if planned)
- Playback resolver (semanticResolver, cascadeResolver) will automatically benefit from landmark_context hints during element resolution

## Self-Check: PASSED

- All 7 key files verified present on disk
- Both task commits (1789005, 7541caa) verified in git log
- 454/454 tests passing

---
*Phase: 036-recording-enrichment*
*Completed: 2026-02-20*
