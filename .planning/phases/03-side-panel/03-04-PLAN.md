---
phase: 03-side-panel
plan: 04
type: execute
wave: 2
depends_on: ["03-02"]
files_modified:
  - entrypoints/sidepanel/components/ScriptList.ts
  - entrypoints/sidepanel/stores/scripts.ts
autonomous: true

must_haves:
  truths:
    - "User can see list of saved scripts"
    - "User can search scripts by name, app, or tag"
    - "User can click a script to open it"
  artifacts:
    - path: "entrypoints/sidepanel/components/ScriptList.ts"
      provides: "Script list UI with search"
      exports: ["ScriptList"]
    - path: "entrypoints/sidepanel/stores/scripts.ts"
      provides: "Reactive script state"
      exports: ["scriptsState", "loadScripts", "searchTerm"]
  key_links:
    - from: "entrypoints/sidepanel/components/ScriptList.ts"
      to: "entrypoints/sidepanel/stores/scripts.ts"
      via: "reactive state binding"
      pattern: "scriptsState"
    - from: "entrypoints/sidepanel/stores/scripts.ts"
      to: "utils/storage/scripts.ts"
      via: "storage calls"
      pattern: "getScripts|searchScripts"
---

<objective>
Create script list component with search/filter functionality using VanJS reactive state.

Purpose: Enable users to see and search their saved scripts, selecting one to open in the editor.
Output: ScriptList component with search input and clickable script items.
</objective>

<execution_context>
@/Users/mmaudet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mmaudet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-side-panel/03-RESEARCH.md
@.planning/phases/03-side-panel/03-02-SUMMARY.md
@utils/storage/scripts.ts
@utils/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create scripts reactive store</name>
  <files>entrypoints/sidepanel/stores/scripts.ts</files>
  <action>
Create entrypoints/sidepanel/stores/scripts.ts:

```typescript
import van from 'vanjs-core';
import type { Script } from '../../../utils/types';
import { getScripts, searchScripts } from '../../../utils/storage/scripts';

// Reactive state
export const scriptsState = van.state<Script[]>([]);
export const searchTerm = van.state('');
export const isLoading = van.state(false);
export const selectedScriptId = van.state<string | null>(null);

// Derived state: filtered scripts
export const filteredScripts = van.derive(() => {
  const term = searchTerm.val.trim().toLowerCase();
  if (!term) return scriptsState.val;

  return scriptsState.val.filter(s =>
    s.name.toLowerCase().includes(term) ||
    s.description?.toLowerCase().includes(term) ||
    s.target_app?.toLowerCase().includes(term) ||
    s.tags?.some(t => t.toLowerCase().includes(term))
  );
});

// Selected script derived state
export const selectedScript = van.derive(() => {
  const id = selectedScriptId.val;
  if (!id) return null;
  return scriptsState.val.find(s => s.id === id) || null;
});

// Load scripts from storage
export async function loadScripts(): Promise<void> {
  isLoading.val = true;
  try {
    scriptsState.val = await getScripts();
  } finally {
    isLoading.val = false;
  }
}

// Listen for storage changes (sync across contexts)
chrome.storage.onChanged.addListener((changes, area) => {
  if (area === 'local' && changes.browserlet_scripts) {
    scriptsState.val = changes.browserlet_scripts.newValue || [];
  }
});

// Select a script
export function selectScript(id: string | null): void {
  selectedScriptId.val = id;
}

// Update a script in local state (after save)
export function updateScriptInState(script: Script): void {
  const scripts = scriptsState.val;
  const index = scripts.findIndex(s => s.id === script.id);
  if (index >= 0) {
    scriptsState.val = [...scripts.slice(0, index), script, ...scripts.slice(index + 1)];
  } else {
    scriptsState.val = [...scripts, script];
  }
}
```
  </action>
  <verify>
1. Import and call loadScripts() - should populate scriptsState
2. Setting searchTerm should filter filteredScripts
3. Storage changes should update scriptsState
  </verify>
  <done>Reactive scripts store with search filtering and storage sync.</done>
</task>

<task type="auto">
  <name>Task 2: Create ScriptList component</name>
  <files>entrypoints/sidepanel/components/ScriptList.ts</files>
  <action>
Create entrypoints/sidepanel/components/ScriptList.ts:

```typescript
import van from 'vanjs-core';
import type { Script } from '../../../utils/types';
import { filteredScripts, searchTerm, isLoading, selectScript, selectedScriptId } from '../stores/scripts';

const { div, input, span, button } = van.tags;

interface ScriptListProps {
  onScriptSelect?: (script: Script) => void;
  onNewScript?: () => void;
}

function ScriptItem({ script, isSelected, onSelect }: {
  script: Script;
  isSelected: boolean;
  onSelect: () => void;
}) {
  return div({
    class: () => `script-item ${isSelected ? 'selected' : ''}`,
    onclick: onSelect,
    style: `
      padding: 12px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      background: ${isSelected ? '#e3f2fd' : 'white'};
      transition: background 0.15s;
    `
  },
    div({ style: 'display: flex; justify-content: space-between; align-items: flex-start;' },
      span({ style: 'font-weight: 500; color: #333;' }, script.name),
      script.target_app && span({
        style: 'font-size: 10px; background: #e0e0e0; padding: 2px 6px; border-radius: 4px; color: #666;'
      }, script.target_app)
    ),
    script.description && div({
      style: 'font-size: 12px; color: #666; margin-top: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;'
    }, script.description),
    script.tags && script.tags.length > 0 && div({
      style: 'margin-top: 6px; display: flex; gap: 4px; flex-wrap: wrap;'
    },
      ...script.tags.map(tag =>
        span({
          style: 'font-size: 10px; background: #f5f5f5; padding: 2px 6px; border-radius: 3px; color: #888;'
        }, tag)
      )
    )
  );
}

export function ScriptList({ onScriptSelect, onNewScript }: ScriptListProps = {}) {
  return div({ class: 'script-list-container', style: 'display: flex; flex-direction: column; height: 100%;' },
    // Search header
    div({ style: 'padding: 12px; background: #f5f5f5; border-bottom: 1px solid #ddd;' },
      div({ style: 'display: flex; gap: 8px; margin-bottom: 8px;' },
        input({
          type: 'text',
          placeholder: chrome.i18n.getMessage('searchPlaceholder') || 'Search scripts...',
          value: searchTerm.val,
          oninput: (e: Event) => { searchTerm.val = (e.target as HTMLInputElement).value; },
          style: 'flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;'
        }),
        onNewScript && button({
          onclick: onNewScript,
          style: 'padding: 8px 12px; background: #4285f4; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 20px; line-height: 1;',
          title: chrome.i18n.getMessage('newScript') || 'New Script'
        }, '+')
      ),
      div({ style: 'font-size: 12px; color: #666;' },
        () => `${filteredScripts.val.length} ${chrome.i18n.getMessage('scripts') || 'scripts'}`
      )
    ),

    // Script list
    div({ style: 'flex: 1; overflow-y: auto;' },
      () => {
        if (isLoading.val) {
          return div({ style: 'padding: 24px; text-align: center; color: #999;' },
            chrome.i18n.getMessage('loading') || 'Loading...'
          );
        }

        const scripts = filteredScripts.val;
        if (scripts.length === 0) {
          return div({ style: 'padding: 24px; text-align: center; color: #999;' },
            searchTerm.val
              ? chrome.i18n.getMessage('noResults') || 'No scripts found'
              : chrome.i18n.getMessage('noScripts') || 'No scripts yet. Create one to get started!'
          );
        }

        return div(
          ...scripts.map(script =>
            ScriptItem({
              script,
              isSelected: selectedScriptId.val === script.id,
              onSelect: () => {
                selectScript(script.id);
                onScriptSelect?.(script);
              }
            })
          )
        );
      }
    )
  );
}
```
  </action>
  <verify>
1. Render ScriptList component
2. Type in search box - list should filter in real-time
3. Click a script item - should call onScriptSelect
4. Empty state shows appropriate message
  </verify>
  <done>
- ScriptList component displays saved scripts
- Search input filters by name, description, app, and tags (UI-02)
- Click handling for script selection
  </done>
</task>

</tasks>

<verification>
1. ScriptList renders saved scripts from storage
2. Search filters scripts in real-time as user types
3. Clicking a script triggers selection callback
4. Empty state messages display correctly
5. Script count updates with search
</verification>

<success_criteria>
- User can see list of saved scripts (UI-01)
- Scripts can be searched/filtered by name, app, tag (UI-02)
- Script selection is tracked in reactive state
</success_criteria>

<output>
After completion, create `.planning/phases/03-side-panel/03-04-SUMMARY.md`
</output>
